import FortuneEngine from"../../engine.js";import setMusicState from"../../autoplay.js";const engine=new FortuneEngine,APP_NAME="cartomancy";let cardsPicked=0,i=0,targetName,sourceContainerID="",droppedID="";const card1s=document.querySelectorAll(".card1"),card2s=document.querySelectorAll(".card2"),card3s=document.querySelectorAll(".card3"),pickContainer1=document.getElementById("pick-container1"),pickContainer2=document.getElementById("pick-container2"),pickContainer3=document.getElementById("pick-container3"),card1sArray=Array.from(card1s),card2sArray=Array.from(card2s),card3sArray=Array.from(card3s);function cancelDefault(e){return e.preventDefault(),e.stopPropagation(),!1}function dragStart(e){e.dataTransfer.setData("text/plain",e.target.id),sourceContainerID=this.parentElement.className,droppedID=this.className}function dropped(e){var t;targetName=e.target.id,this.id!==sourceContainerID&&(cancelDefault(e),"card1"===droppedID?(t=card1sArray[i],e.target.appendChild(card1sArray[i]),t.draggable=!1,cardsPicked++,i++):"card2"===droppedID?(t=card2sArray[i],e.target.appendChild(card2sArray[i]),t.draggable=!1,cardsPicked++,i++):"card3"===droppedID&&(t=card3sArray[i],e.target.appendChild(card3sArray[i]),t.draggable=!1,cardsPicked++,i++),0<document.getElementById("pick-container1").children.length&&(document.getElementById("pick-container1").style.userSelect="none",document.getElementById("pick-container1").style.pointerEvents="none"),0<document.getElementById("pick-container2").children.length&&(document.getElementById("pick-container2").style.userSelect="none",document.getElementById("pick-container2").style.pointerEvents="none"),0<document.getElementById("pick-container3").children.length)&&(document.getElementById("pick-container3").style.userSelect="none",document.getElementById("pick-container3").style.pointerEvents="none"),1===cardsPicked&&(document.querySelector("#reset-button").style.display="flex"),3===cardsPicked&&(document.querySelectorAll(".read-fortune-space")[0].style.display="flex")}function readCards(e){e.classList.add("container"),document.getElementById("read-fortune-button").style.display="none";var t=engine.get_random_subset(3);for(let e=1;e<4;e++)organizeCards(document.getElementById("pick-container"+e),t[e-1])}function organizeCards(e,t){e.removeChild(e.firstChild),e.classList.remove("pick-container"),e.classList.add("read-container");var n=document.createElement("div"),d=document.createElement("div"),a=document.createElement("img"),r=document.createElement("div"),c=document.createElement("p"),i=document.createTextNode(t.result);c.classList.add("read-fortune"),n.classList.add("card-show"),d.classList.add("image"),a.setAttribute("href","#"),a.setAttribute("src",`/src/assets/cart/${t.image}.png`),r.classList.add("content"),c.appendChild(i),n.appendChild(d),d.appendChild(a),r.appendChild(i),n.appendChild(r),e.appendChild(n)}card1s.forEach(e=>{e.addEventListener("dragstart",dragStart)}),card2s.forEach(e=>{e.addEventListener("dragstart",dragStart)}),card3s.forEach(e=>{e.addEventListener("dragstart",dragStart)}),pickContainer1.addEventListener("drop",dropped),pickContainer1.addEventListener("dragenter",cancelDefault),pickContainer1.addEventListener("dragover",cancelDefault),pickContainer2.addEventListener("drop",dropped),pickContainer2.addEventListener("dragenter",cancelDefault),pickContainer2.addEventListener("dragover",cancelDefault),pickContainer3.addEventListener("drop",dropped),pickContainer3.addEventListener("dragenter",cancelDefault),pickContainer3.addEventListener("dragover",cancelDefault),document.addEventListener("DOMContentLoaded",async()=>{await engine.db_reader(`./${APP_NAME}.json`);const e=document.getElementById("music"),n=new Audio("/src/assets/cart/cartomancy-bgm.mp3");n.loop=!0,n.play().then(()=>{}).catch(()=>{d=!1,setMusicState(n,e,d)});let d=!0,t=!1;var a=document.getElementById("music-button"),r=document.getElementById("info-button"),c=document.getElementById("read-fortune-button"),i=document.getElementById("start-button");const o=document.getElementById("card-display"),s=document.getElementById("center-div");i.addEventListener("click",e=>{document.getElementById("intro").style.display="none",o.style.display="initial",document.getElementById("start-button").style.display="none",document.getElementById("pick-container1").style.display="flex",document.getElementById("pick-container2").style.display="flex",document.getElementById("pick-container3").style.display="flex"}),c.addEventListener("click",e=>{document.getElementById("pick-container1").style.userSelect="auto",document.getElementById("pick-container1").style.pointerEvents="auto",document.getElementById("pick-container2").style.userSelect="auto",document.getElementById("pick-container2").style.pointerEvents="auto",document.getElementById("pick-container3").style.userSelect="auto",document.getElementById("pick-container3").style.pointerEvents="auto",o.classList.add("hide-cards"),setTimeout(()=>{o.remove(),readCards(s)},1e3)}),a.addEventListener("click",e=>{console.log("music");var t=document.getElementById("music");d?(t.src="/src/assets/audio_off.png",n.pause()):(t.src="/src/assets/audio_on.png",n.play()),d=!d}),r.addEventListener("click",e=>{document.getElementById("info-popup").style.display=t?"none":"flex",t=!t}),document.getElementById("reset-button").addEventListener("click",e=>{window.location.reload()})});
