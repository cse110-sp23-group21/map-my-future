import FortuneEngine from"../../engine.js";import setMusicState from"../../autoplay.js";document.addEventListener("DOMContentLoaded",async()=>{const l=new FortuneEngine("ying_yang_coin");await l.db_reader("yin_yang_coin.json");let r=0,c=0,m=1;const d=l.get_json_contents().hexagrams;var e=document.querySelector(".action-button"),t=document.getElementById("music-button");const n=document.getElementById("music");var i=document.getElementById("info-button");const y=document.querySelector(".line-image"),u=document.getElementById("line-text"),g=document.querySelectorAll(".side-grid-element"),p=document.querySelector(".content-grid"),v=document.getElementById("instruction-image"),T=document.getElementById("instruction-text"),f=document.getElementById("interpretation-text"),b=document.getElementById("character"),E=document.querySelector(".coin-display"),L=document.getElementsByClassName("coins");let s=!0,o=!1;const a=new Audio("../../assets/coin/bgm-background.mp3"),w=new Audio("../../assets/coin/bgm-coin-flip.ogg"),k=new Audio("../../assets/coin/bgm-hex-reveal.mp3"),x=new Audio("../../assets/coin/bgm-line-reveal.mp3"),M=new Audio("../../assets/coin/bgm-button-click.wav");a.loop=!0,a.volume=.4,w.volume=.5,k.volume=.5,x.volume=.5,M.volume=.5,a.play().then(()=>{}).catch(()=>{s=!1,setMusicState(a,n,s)}),t.addEventListener("click",e=>{s=setMusicState(a,n,!s)}),i.addEventListener("click",e=>{document.getElementById("info-popup").style.display=o?"none":"flex",o=!o}),e.addEventListener("click",e=>{const t=e.target;switch(t.value){case"start":M.play(),t.value="toss",t.innerText="Toss Coins",u.innerText="Record 0/6",u.style.fontSize="3rem",v.style.display="none",T.style.display="none",y.style.display="none",E.style.display="block";break;case"toss":var n=l.get_random_subset(1)[0],n=(c+=n.value*m,m<<=1,r++,"Yin"===n.type?setTimeout(function(){g[r-1].innerHTML+='<img class="animated-line-image" src="../../assets/coin/line-broken.png" alt="instruction image display failed."/>',x.play()},4500):setTimeout(function(){g[r-1].innerHTML+='<img class="animated-line-image" src="../../assets/coin/line-solid.png" alt="instruction image display failed."/>',x.play()},4500),setTimeout(function(){u.innerText="Record "+r+"/6"},5500),n.coins.toLowerCase()),i=n.slice(0,1),s=n.slice(1,2),n=n.slice(2,3);L[0].style.animation=`${i}-rotate-${r%2} 4.3s ease forwards`,L[1].style.animation=`${s}-rotate-${r%2} 4.3s ease forwards`,L[2].style.animation=`${n}-rotate-${r%2} 4.3s ease forwards`,w.play(),t.style.pointerEvents="none",t.innerText="Tossing Coins...",setTimeout(()=>{t.style.pointerEvents="all",t.innerText="Toss Coins",6===r&&(t.value="result",t.innerText="Get Result")},5500);break;case"result":k.play();const o=d[c];t.value="reset",t.innerText="New Round",b.innerHTML=o.character,T.innerHTML=`"${o.name}"`,f.innerHTML=`"${o.meaning}"`,setTimeout(()=>{b.className="active",2===o.character.length?b.style.marginRight="1%":b.style.marginRight="3%"},3500),T.style.animation="blurfadein 3s ease-in forwards",T.style.fontSize="8vh",T.style.margin="0",T.style.padding="0",T.style.display="block",E.style.display="none",p.style.display="grid",setTimeout(()=>{f.style.display="inline-block"},7500),t.style.pointerEvents="none",setTimeout(()=>{t.style.pointerEvents="all"},11e3);break;case"reset":M.play(),c=0,r=0,m=1,t.value="start",t.innerText="Start";for(const a of L)a.style.animation="none";b.innerHTML="",f.innerHTML="",T.innerHTML="Coin Combination",u.innerHTML="Side Info",b.className="inactive",T.style.fontSize="2rem",T.style.margin="",T.style.padding="",T.style.animation="none",v.style.display="inline-block",f.style.display="none",p.style.display="",u.style.fontSize="2rem",y.style.display="inline-block";for(let e=0;e<6;e++)g[e].innerHTML=""}})});
